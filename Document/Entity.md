# Entity 系統 - GameModel 戰鬥實體架構

## 🎯 Entity 系統定位與架構價值

**Entity 系統是 GameModel 中負責戰鬥實體管理的核心層級**，將 GameData 的靜態定義與 Instance 的運行時狀態轉換為戰鬥中可操作的動態實體。此系統建立了完整的**陣營-單位-資源**三層架構，並提供統一的**多目標增益系統**，是整個戰鬥邏輯的核心基礎。

## 📊 子系統總覽

- **[Player 子系統](Player.md)**： (多資源管理與性情機制)
- **[Character 子系統](Character.md)**：(多單位狀態管理)  
- **[Card 子系統](Card.md)**： (卡片實體管理與區域協調)
- **[CardBuff 子系統](CardBuff.md)**： (卡片狀態管理與觸發邏輯)
- **[Session 子系統](Session.md)**： (創新的機制設計與生命週期管理)

## 🏗️ Entity 系統核心架構

### 三層實體架構設計

#### 陣營層實體 - Player 系統
**職責範圍**：管理陣營級別的戰略資源與狀態
- **資源統籌**：手牌、牌庫、能量、性情等陣營共享資源
- **戰略狀態**：影響整個陣營的持續性狀態與增益
- **多單位協調**：統籌陣營下多個角色單位的資源分配

#### 單位層實體 - Character 系統  
**職責範圍**：管理個體戰鬥單位的狀態與行為
- **個體狀態**：生命值、護甲、個體專屬的增益減益
- **戰術行為**：單位層級的戰鬥行動與狀態反應
- **多單位支援**：支援敵方多個單位同時存在的戰鬥邏輯

#### 資源層實體 - Card 系統
**職責範圍**：管理戰鬥中的卡牌資源與狀態
- **卡牌狀態**：戰鬥內卡牌的動態屬性與臨時修改
- **區域管理**：不同卡牌區域的集合管理與轉移邏輯
- **效果載體**：作為效果觸發與目標選擇的重要載體

### Player-Character 階層關係

#### 階層設計原則
```
Player (陣營) 
├── Energy/Disposition (陣營資源)
├── CardManager (卡牌資源統籌)
├── PlayerBuff (陣營增益)
└── Characters[] (角色單位集合)
    ├── Character 1 (MainCharacter - 主要角色)
    ├── Character 2 (敵方單位A)
    └── Character N (敵方單位N)
```

#### 職責分工明確化
**Player 專責領域**：
- **戰略資源**：能量系統、手牌管理、牌庫與墓地
- **陣營狀態**：性情機制、陣營級別的增益效果
- **資源分配**：為角色單位的行動提供能量與卡牌支持
- **勝負判定**：當所有角色單位死亡時，陣營失敗

**Character 專責領域**：
- **個體狀態**：生命值、護甲、個體層級的狀態效果
- **戰鬥行為**：受到攻擊、施放技能等單位行為
- **個體增益**：只影響單個角色的增益減益效果
- **存活管理**：個體的死亡狀態與復活邏輯

#### 協作模式設計
- **資源下發**：Player 向 Character 提供戰鬥所需的能量與卡牌
- **狀態上報**：Character 向 Player 回報戰鬥結果與狀態變化
- **統籌協調**：Player 統籌多個 Character 的協同作戰策略

## 🛡️ 三重增益系統架構

### 多目標增益設計理念
**不同作用目標的增益效果需要不同的管理策略與生命週期**，三重增益系統提供完整的目標覆蓋與精確的效果管理。

### PlayerBuff - 陣營增益系統
**作用目標**：整個陣營（Player 實體）  
**影響範圍**：陣營內所有資源與角色單位 

**特色設計**：
- **範圍影響**：一個 PlayerBuff 可以影響陣營內的所有實體
- **資源導向**：主要影響能量、卡牌、性情等陣營資源

### CharacterBuff - 角色增益系統
**作用目標**：單個角色實體（Character 實體）  
**影響範圍**：特定角色的屬性與狀態  

**特色設計**：
- **精確目標**：只影響被施加的特定角色
- **戰鬥導向**：主要影響生命、護甲、攻擊等戰鬥屬性

### CardBuff - 卡牌增益系統  
**作用目標**：單張卡牌實體（Card 實體）  
**影響範圍**：特定卡牌的屬性與效果

**特色設計**：
- **卡牌特化**：專門針對卡牌的屬性與效果進行修改
- **效果導向**：主要影響卡牌的使用效果與觸發邏輯

### 三重增益的協作模式
```
PlayerBuff (陣營增益)
├── 影響 Character 的基礎屬性
├── 影響 Card 的使用條件
└── 提供跨實體的統一增益

CharacterBuff (角色增益)
├── 與 PlayerBuff 疊加計算屬性
└── 影響個體的戰鬥表現

CardBuff (卡牌增益)
├── 與 PlayerBuff 疊加計算效果
└── 修改特定卡牌的行為邏輯
```

## 🔄 Session 系統的特殊定位

### 區域變數機制
**[Session 系統](Session.md)** 在 Entity 架構中擔任**臨時狀態管理**的特殊角色
- **生命週期管理**：不同於永久性的 Buff，Session 具有明確的生命週期
- **條件計數**：實現「每N次就觸發」的複雜計數機制
- **跨實體應用**：可以在 Player、Character、Card 之間靈活應用

### 與增益系統的差異
- **Buff 系統**：持續性的屬性修改與狀態增益
- **Session 系統**：臨時性的計數與條件觸發機制

---

**系統複雜度**：⭐⭐⭐⭐⭐ (高度複雜的多層級實體管理與狀態協調)  
**維護重點**：實體狀態一致性、多層級協作穩定性、增益系統平衡性