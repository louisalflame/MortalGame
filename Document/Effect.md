# Effect 子系統 - 遊戲效果定義與執行機制

## 🎯 子系統定位與職責

**Effect 子系統是 GameModel 中負責遊戲效果定義與執行的核心執行機制**，採用**效果定義與執行分離**的架構設計，透過 Record 類型定義各種遊戲效果，並交由統一的 Executor 進行實際執行，涵蓋卡片效果、Buff 觸發效果以及遊戲規則的基礎效果。

## 📊 效果系統架構設計

### 定義-執行分離設計
**效果定義層**：使用 Record 類型定義各種效果的參數與配置
**執行引擎層**：統一的 EffectExecutor 負責效果的實際執行邏輯
**結果回饋層**：標準化的效果執行結果與事件生成
**反應觸發層**：效果執行後的連鎖反應與觸發處理

### 核心效果架構

#### 效果執行引擎
**[EffectExecutor.cs](Assets/Scripts/GameModel/Effect/EffectExecutor.cs)** 提供統一的效果執行機制
- **模式匹配執行**：使用 C# Switch 表達式對不同效果類型進行精確匹配與執行
- **上下文驅動**：基於 `TriggerContext` 的效果執行，確保效果在正確的遊戲狀態下觸發
- **結果標準化**：所有效果執行都回傳統一的 `EffectResult` 結構

#### 效果分類系統
EffectExecutor 支援完整的遊戲效果分類：

**戰鬥傷害效果**
**角色狀態效果**
**資源管理效果**
**Buff 管理效果**
**卡牌操作效果**

### 效果結果系統

#### 效果執行結果
**[EffectEventResult.cs](Assets/Scripts/GameModel/Effect/EffectEventResult.cs)** 定義標準化的效果執行結果
- **數值記錄**：詳細記錄效果執行的數值變化（實際值、變化量、溢出值）
- **類型標識**：標記效果的具體類型與執行方式
- **結果分類**：涵蓋傷害、治療、護盾、能量、好感度、Buff 等所有效果結果

## 🔧 執行機制設計

### 效果執行流程
1. **效果定義**：透過 Record 類型定義效果參數
2. **上下文準備**：建立包含觸發資訊的 `TriggerContext`
3. **執行分派**：EffectExecutor 根據效果類型分派到對應的處理方法
4. **數值計算**：基於遊戲狀態與效果參數計算實際效果數值
5. **狀態更新**：更新遊戲實體的狀態
6. **事件生成**：產生對應的遊戲事件用於視覺回饋
7. **反應觸發**：處理效果執行後的連鎖反應

### 意圖-結果追蹤
- **意圖聲明**：每個效果執行前先聲明意圖（IntentAction）
- **結果記錄**：執行後產生對應的結果動作（ResultAction）
- **反應支援**：為後續的反應觸發提供完整的效果脈絡
